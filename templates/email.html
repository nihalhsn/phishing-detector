<!DOCTYPE html>
<html>
<head>
<title>Email View</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
    margin:0;
    font-family:'Segoe UI', sans-serif;
    background:#f3f4f6;
}

.container {
    max-width:800px;
    margin:40px auto;
    background:white;
    padding:30px;
    border-radius:12px;
    box-shadow:0 10px 30px rgba(0,0,0,0.05);
}

.header {
    border-bottom:1px solid #e5e7eb;
    padding-bottom:15px;
    margin-bottom:20px;
}

.email-body {
    white-space:pre-line;
}

button {
    padding:10px 15px;
    margin:5px;
    border:none;
    border-radius:8px;
    cursor:pointer;
}

.reply { background:#10b981; color:white; }
.report { background:#ef4444; color:white; }
.download { background:#f59e0b; color:white; }

.timer {
    color:red;
    font-weight:600;
    margin-bottom:15px;
}
</style>
</head>
<body>

<div class="container">

    {% if timer %}
    <div class="timer">
        ‚è≥ Time Remaining: <span id="countdown">30</span>s
    </div>
    {% endif %}

    <div class="header">
        <h2>{{email.subject}}</h2>
        <div>From: {{email.sender}}</div>
    </div>

    <div class="email-body">
        {{email.body | safe}}
    </div>

    {% if email.attachment %}
        <button class="download"
            onclick="location.href='/action/{{email.id}}/download'">
            Download Attachment
        </button>
    {% endif %}

    <br><br>

    <button class="reply"
        onclick="location.href='/action/{{email.id}}/reply'">
        Reply
    </button>

    <button class="report"
        onclick="location.href='/action/{{email.id}}/report'">
        Report Phishing
    </button>

    <button onclick="location.href='/inbox'">
        Back
    </button>

</div>

{% if timer %}
<script>
let time = 30;
let interval = setInterval(function(){
    time--;
    document.getElementById("countdown").innerText = time;
    if(time <= 0){
        clearInterval(interval);
        window.location.href = "/action/{{email.id}}/reply";
    }
},1000);
</script>
{% endif %}

<!-- Slide-in Notification -->
<div id="email-toast" class="toast">
    üìß New urgent email received! Click to open.
</div>

<style>
.toast {
    position: fixed;
    top: 20px;
    right: -400px;
    background: #1a73e8;
    color: white;
    padding: 16px 24px;
    border-radius: 12px;
    box-shadow: 0 12px 30px rgba(0,0,0,0.25);
    font-weight: 500;
    transition: right 0.5s ease;
    z-index: 9999;
    cursor: pointer;
}
.toast.show {
    right: 20px;
}
</style>

<script>
const toast = document.getElementById("email-toast");
let latestEmailId = null;

function showToast(emailId) {
    latestEmailId = emailId;
    toast.classList.add("show");

    toast.onclick = function() {
        window.location.href = "/email/" + latestEmailId;
    };

    setTimeout(() => {
        toast.classList.remove("show");
    }, 6000);
}

function triggerNewEmail() {
    fetch("/new_email")
        .then(response => response.json())
        .then(data => {
            showToast(data.id);
        });
}

setInterval(() => {
    triggerNewEmail();
}, 20000);
</script>


</body>
</html>
